---
title: "5.5 着色器"
sidebar: rtr
layout: book
permalink: rtr_ch5_shading.html
---

### 5.5 着色器
着色是使用一个公式，依据材质属性和光源，来计算视线v方向上的输出辐射度$L_0$。第七章会探讨很多可行的着色公式。这里我们使用一个相对简单的例子来作为说明，并说明如何使用在可编程着色器中实现它。

我们使用的公式中包括漫反射和高光部分。漫反射部分很简单。根据上一节中的定义，我们可以得到漫反射出射度$M_{diff}$是光线辐照度$E_L$，它的方向*l*和漫反射颜色的函数：

$$
M_{diff} = c_{diff} \bigotimes E_L \overline{cos} \theta_i.    \tag{5.3}
$$

这里$\bigotimes$表示对向量按位乘（这里都是RGB向量）。

因为我们假定漫反射在各个方向上的辐射度$L_{diff}$都是一样，于是得到以下关系式（7.5.1会详细解释原因）：

$$
L_{diff} = \frac{M_{diff}}{\pi}. \tag{5.4}
$$

将公式5.3，5.4连起来，我们可以得到：

$$
L_{diff} = \frac{c_{diff}}{\pi} \bigotimes E_L \overline{cos} \theta_i. \tag{5.5}
$$

这种漫反射着色方式也被称为`Lambertian`， 它遵从`兰伯特定律(Lambert's law)`，这个定律定义了理想漫反射表面输出的辐射率跟$\overline{cos}\theta_i$成正比。注意，这个限制范围的余弦因子（一般使用法线*n*与光线*l*点乘得到，使用max(n·l,0）并不是兰伯特表面特有的；正如我们看到的，它一般使用在辐照度上。兰伯特表面的特点是输出的辐射率正比与辐照度。只要你看过兰伯特的着色代码，就会发现除了$1/\pi$跟等式5.5很相像。这个因子在实时渲染中一般已经包含在$E_L$中了。（7.5节会深入相关细节）




