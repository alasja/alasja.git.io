---
title: "5.6 走样和反走样"
sidebar: rtr
layout: book
permalink: rtr_ch5_aliasing.html
---

### 5.6 走样和反走样
想象一个很大的黑色三角形在白色背景中缓慢移动。屏幕的网格点被三角形覆盖到，则该点逐渐平滑的显现出来。但是通常各种类型基础的渲染器都是在网格点的中心北覆盖的瞬间，颜色从白变成黑。标准GPU的绘制都是这样。可见图5.18的左图

![图](/images/RTR3.05.18.png)
图5.18 <font color="gray">上面一行的图片展示的是在不同抗锯齿级别下，三角形、点、线的成像。下面一行是上面图像的放大版本。左侧图每个像素点只有一个采样点，也就是没有任何抗锯齿效果。中间图像每个像素点则是4个网格采样点，右图则是使用8个采样点（4*4的棋盘，译：这不应该是16么？）。这些图像使用`InfiniteReality`渲染</font>

多边形在像素中只有覆盖和不覆盖两种状态。线条绘制有同样的问题。边缘因此会有一些锯齿的形状，这种不真实的表现被称为“锯齿”，在动画中就会变成“蠕动的毛毛虫(the crawlies)”。这些问题的正式的名字是`“走样(aliasing)”`，去除走样的技术被称为`反走样(antialiasing)`。

采样理论和数字过滤是一个很大的主题，可以在参考文献[422,1035,1367]中看到。作为渲染的关键领域，我们会介绍一些相关的基础理论。然后我们就主要关注，在实时渲染中如何减少走样的问题。


### 5.6.1 采样和过滤理论
渲染图片实际上是一个采样的过程。这是因为图片的生成过程就是从三维场景中采样，来决定图片（不连续的像素列表）的每个像素颜色值。要使用纹理映射（见第六章），纹理需要针对不同的坐标重新采样得到合适的结果。为了得到动画中的图像序列，动画一般使用固定的时间间隔来采样。本节的主题四介绍采样、重建和过滤。为了简单起见，大部分材质都在一维下表现。这些概念很自然的可以扩展到二维，所以也就可以被用到二维图片的使用中。


![图](/images/RTR3.05.19.png)
图5.19

图5.19展示了一个连续的信号，如何使用固定的间隔采样，这是离散化的。采样的目的是数字化的表达信息。采样之后，信息的数量降低了。不过采样的信号最终还是需要`重建(recostructed)`成原始信息的样子。这是对采样信号使用`过滤(filtering)`来实现的。

当采样结束后，就可能发生走样。这是一个不期望的效果，我们需要处理它以产生更好的图像。现实生活中，一个经典走样的例子是使用摄像机来拍摄纺纱轮[404]。因为轮子转动速度要比相机记录的速度快，所以轮子可能表现出缓慢的旋转(顺着转或者倒着转)，甚至看起来根本不在转。这种现象可在图5.20中看到。这种结果是因为轮子的图像的拍摄，使用了一些不同的时间间隔，这也被称为`暂时走样(temporal aliasing)`

![图](/images/RTR3.05.20.png)
图5.20，采样使用不同的时间间隔，获取的图像不一样，以至于最后看起来轮子的表现也不同。

计算机图形中，走样比较常见的例子是栅格化线条或多边形边缘、闪烁的高光、以及纹理使用棋盘模式采样的各类锯齿（可见6.2.2节）。

![图](/images/RTR3.05.21.png)
图5.21 <font color="gray">蓝实线表示源信号，红点是离散的固定间隔获取的采样点，绿色虚线是重建的信号。上面展示了一个非常低的采样速率。尽管如此，重建的信号显示了一个比较低的频率。下面的采样速率恰好是源信号频率的两倍，重建的信号变成了一条水平线。这可以证明即便采样速率只是轻微的改变，也可能完美的重建图像 </font>

当信号采样的频率太低的时候，就会发生走样。采样的信号的频率可能出现比源信号的频率低。这可以在图5.21中看到。`一个被正确采样的信号（也就是，能够使用采样信号重建源信号），采样的频率需要大于源信号极限频率的两倍`。这通常被称为`采样定理(sampling theorem)`，这个采样频率被称为`Nyquist 速率`[1035,1367]或者`Nyquist极限`[1332]。`Nyquist极限`也可以在图5.20中看到。定理中使用的术语`极限频率`表示信号是`频带限制(bandlimited)`的，也就是说一个特点极限下，不是任何频率都可以的。从另一个角度来看就是，在两个相邻的采样点之间，信号需要足够的平滑。

一个采用点采样绘制的三维场景，通常没有什么`频带限制`。多边形的边缘，引用的边缘，以及其他现象产生的信号都是不连续的，所以他们的频率也就没有什么限制[170]。而且不论采样点有多么密集，对象也有可能小到无法采样。因此，在渲染场景的时候，没法完全避免走样问题。尽管如此，有时也需要知道信号何时是`频带限制`的。一个例子就是当纹理应用到表面的时候。可以比较纹理采样的频率和像素采样频率。如果这个频率低于`Nyquist极限`，那么不需要做什么操作就可以得到正确的纹理采样。如果这个频率太高，则需要使用纹理使用的采样频率（见6.2.2节）。


### 5.6.1.1 重建 Reconstruction


