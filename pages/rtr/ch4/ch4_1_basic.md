---
title: "基础变换"
sidebar: rtr
layout: book
permalink: rtr_ch4_basic.html
summary: 第四章.
---

### 变换

> What if angry vectors veer
> Round your sleeping head, and form,
> There's never need to fear
> Violence of the poor world's abstract storm.
>             -- Robert Penn Warren



变换是对实体（如点、向量或者颜色）的一种转变操作。对图形工作者来说，掌握变换非常非常重要。使用这个工具，你能设置位置、改变形状、对物体灯光相机做动画等。你也能确保所有的计算是在同一个坐标系统下，还可以使用不同的方式把对象投影到一个平面上。变换的操作其实比较少，但是他们却在实时图形中扮演着非常重要的角色，或者说，在所有的计算机图形中都很重要。

线性变换就是向量相加或与常数相乘。如下：

$$
	f(x) + f(y) = f(x + y), \\
	kf(x) = f(kx). \tag{4.1}
$$

比如说，$f(x) = 5x$就是一个变换，它把向量的每个元素放大5倍。这种变换就是线性变换，任何两个向量先放大五倍后相加，与先相加再放大五倍的结果一样。这与标量的乘法一致。这个函数称为缩放变换，它缩放对象的大小。旋转变换也是线性变换，它把向量绕原点旋转。缩放和旋转变换可以表示成3x3的矩阵，实际上所有作用于3个元素向量的线性变换，都能这么表示。

不过，这个大小的矩阵通常还不够大。一个作用于三个元素向量的函数，如$f(x) = x + (7,3,2)$就不是线性的。对两个单独的向量都进行这个变换会给每个向量都加上`(7,3,2)`。给向量加上一个固定向量也是一个变换，它可以把所有位置都移动相同的偏移位置。这是一种很有用的变换，我们可能会想要把多个变换组合起来，比如缩放一个对象到一半大小，再移动另一个位置。但如果还是用原来的函数形式，就很难将他们组合起来。

仿射变换(`affine transform`)可以组合线性变换和位移变换，一般使用4x4的矩阵来存储。一个仿射变换表示先进行一个线性变换，然后一个位移操作。我们使用齐次坐标来表示4个元素的向量，统一表示点和向量（使用小写粗体字母）。向量表示成$v = (v_x\ v_y \ v_z\ 0)^T$，点则表示为$v = (v_x\ v_y\ v_z\ 1)^T$。本周会大量使用附录A中介绍的各种术语。你可能现在就想看看附录，特别是附录A.4,关于齐次表示的章节。

所有的平移、旋转、缩放、反射以及错切矩阵都是仿射变换。仿射矩阵的主要特性是能保持线条的平行性，长度和角度就说不准了。一个仿射变换可以是其他任意数量仿射变换的组合。

本章会从最基本的仿射变换开始。这部分非常基础，甚至可以当做是简单变换的说明文档。后面会讨论和描述一些特别的矩阵，以及四元数，四元数是一个非常强大的变换工具。然后是顶点混合和变形，这两个是网格动画的简单而有效的操作方式。最后，我们会讲解投影矩阵。这些矩阵、符号、函数以及属性都可以在表格4.1中看到

![图](/images/RTR3.04.01t.png)


### 4.1 基础变换
本节描述大部分基础变换，包括平移、旋转、缩放、错切，以及变换组合，刚体变换，法线变换（这个可不`normal` :)，以及逆的计算。对于有经验的读者，这部分可以作为帮助文档，对于初学者，这部分可以作为入门介绍。这部分是非常必要的基础知识，不仅是这章后面的基础，也是本书其他后续章节的基础。我们从最最简单的平移开始。



### 4.1.1 平移
平移矩阵把一个位置变换到另一个位置，是用T来表示。这个矩阵使用向量$t=(t_x\ t_y\ t_z)$来位移对象。 T 的表示如下：

$$
T(t) = T(t_x, t_y, t_z) = 
\begin{pmatrix} 
1 & 0 & 0 & t_x \\ 
0 & 1 & 0 & t_y \\
0 & 0 & 1 & t_z \\
0 & 0 & 0 & 1 \end{pmatrix}  \tag{4.2}
$$

![图](/images/RTR3.04.01.png)
图4.1

图4.1展示了平移变换的效果。我们可以很明显的看到（你得会矩阵相乘的规则），对于点$p = (p_x, p_y, p_y, 1)$使用T(t)变换后得到新点$p^{`} = (p_x + t_x, p_y + t_y, p_z + t_z, 1)$，这是一个明显的平移。注意，向量$v = (v_x, v_y, v_z, 0)$使用T来操作就没有任何效果，因为向量没法被平移。除此之外，其他所有的仿射变换都可以同时作用在点和向量上。平移矩阵的逆是负的t，$T^{-1}(t) = T(-t)$


### 4.1.2 旋转
旋转变换是给定一个角度、一个穿过原点的坐标轴，来旋转一个向量（点和向量）。跟平移一样，这也是一个刚体变换，就是说变换后，点和点之间的距离不会发生变化，左右顺序也不会变化（绝不会导致左右颠倒）。这两个变换在计算机图形对于物体的定位和朝向非常有用。一个朝向矩阵就是相机视图关联的旋转矩阵，或对象在空间中朝向的定义，也就是向上或前的方向。通常使用的旋转矩阵表示为 $R_x(\theta),R_y(\theta),R_z(\theta)$，表示相对xyz轴旋转$\theta$弧度。他们的矩阵表示如下

$$
R_x(\theta) = \begin{pmatrix}
1 & 0 & 0 & 0 \\
0 & cos\theta & -sin\theta & 0 \\
0 & sin\theta & cos\theta & 0 \\
0 & 0 & 0 & 1  \end{pmatrix}  \tag{4.3}
$$

$$
R_y(\theta) = \begin{pmatrix}
cos\theta & 0 & sin\theta & 0 \\
0 & 1 & 0 & 0 \\
-sin\theta & 0 & cos\theta & 0 \\
0 & 0 & 0 & 1  \end{pmatrix}  \tag{4.4}
$$

$$
R_z(\theta) = \begin{pmatrix}
cos\theta & -sin\theta & 0 & 0 \\
sin\theta & cos\theta & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1  \end{pmatrix}  \tag{4.5}
$$

对于每个3x3的旋转矩阵R(矩阵左上的3x3范围），绕任意轴旋转角度$\theta$，它的迹（定义见附录A）与轴无关，计算如下：

$$
tr(R) = 1 + 2cos\theta. \tag{4.6}
$$

![图](/images/RTR3.04.04.png)
图4.4

图4.4展示了旋转矩阵的作用效果。旋转矩阵$R_i(\theta)$的主要特征是，它绕i轴旋转，他是在i轴上的所有点，都没有任何变化。有时会用R表示绕任意轴旋转的矩阵。上面给出的旋转矩阵组合，可以表现任意轴（非xyz轴）的旋转。

